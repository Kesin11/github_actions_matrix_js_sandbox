name: "CI in docker"
on: [push]

jobs:
  check_pr:
    # strategy:
    #   matrix:
    #     tag: [10, 12, lts]

    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1

    # with: args:でdocker内でコマンドを実行できることは https://github.com/actions/migrate/blob/1ea00e246e24e694f2d3d6c269c964d61548c89d/fixtures/action-args-runs/.github/workflows/push.yml 参照
    - name: "node version"
      uses: docker://circleci/node:10
      with:
        args: node --version

    - name: "whoami"
      run: whoami

    - name: "whoami in docker"
      uses: docker://circleci/node:10
      with:
        args: whoami

    - name: "sudo whoami"
      uses: docker://circleci/node:10
      with:
        args: sudo whoami

    - name: "env in VM"
      run: env
      continue-on-error: true

    - name: "env in docker"
      uses: docker://circleci/node:10
      continue-on-error: true
      with:
        args: env

    - name: "ls -l"
      run: ls -l /home/**
      continue-on-error: true

    - name: "ls -l GITHUB_WORKSPACE in VM"
      run: ls -l $GITHUB_WORKSPACE
      continue-on-error: true

    - name: "ls -l /github/workspace in docker"
      uses: docker://circleci/node:10
      continue-on-error: true
      with:
        args: sudo ls -l /github/workspace

    # SUDOを付ける必要があるのは、docker内のuserとVMのuserが異なるから、だろうか？
    - name: "npm ci"
      uses: docker://circleci/node:10
      with:
        args: sudo npm ci

    - name: "npm run build"
      uses: docker://circleci/node:10
      with:
        args: sudo npm run build

    - name: "npm run test"
      uses: docker://circleci/node:10
      with:
        args: sudo npm run test
